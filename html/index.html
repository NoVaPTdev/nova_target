<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<title>NOVA Target</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    width: 100vw; height: 100vh; overflow: hidden;
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
    background: transparent; user-select: none; cursor: default;
    pointer-events: none;
  }

  #target-wrapper {
    position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    display: none; align-items: center; gap: 12px; z-index: 999;
  }
  #target-wrapper.visible { display: flex; }

  /* ── Crosshair ── */
  .eye {
    position: relative; width: 24px; height: 24px;
    display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  }
  .eye-dot {
    width: 4px; height: 4px; border-radius: 50%;
    background: rgba(255, 255, 255, 0.85);
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.3);
    transition: all 0.25s ease;
  }
  .eye-ring {
    position: absolute; top: 50%; left: 50%;
    width: 18px; height: 18px; border-radius: 50%;
    border: 1.5px solid rgba(255, 255, 255, 0.25);
    transform: translate(-50%, -50%);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .eye-pulse {
    position: absolute; top: 50%; left: 50%;
    width: 18px; height: 18px; border-radius: 50%;
    border: 1px solid rgba(255, 255, 255, 0.08);
    transform: translate(-50%, -50%);
    animation: pulse 2.5s ease-out infinite; pointer-events: none;
  }

  /* Active state */
  #target-wrapper.has-target .eye-dot {
    width: 5px; height: 5px;
    background: #a0ff4f;
    box-shadow: 0 0 10px rgba(160, 255, 79, 0.5);
  }
  #target-wrapper.has-target .eye-ring {
    width: 22px; height: 22px;
    border-color: rgba(160, 255, 79, 0.4);
  }
  #target-wrapper.has-target .eye-pulse {
    border-color: rgba(160, 255, 79, 0.12);
  }

  @keyframes pulse {
    0%   { width: 18px; height: 18px; opacity: 0.4; }
    100% { width: 36px; height: 36px; opacity: 0; }
  }

  /* ── Options ── */
  .options { display: flex; flex-direction: column; gap: 4px; }

  .option {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 14px 8px 10px;
    border-radius: 8px;
    background: rgba(25, 25, 25, 0.55);
    border: 1px solid rgba(255, 255, 255, 0.10);
    cursor: pointer;
    transition: all 0.18s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0; transform: translateX(-6px);
    animation: slideIn 0.18s ease forwards;
    pointer-events: auto;
  }

  .option:hover {
    background: rgba(160, 255, 79, 0.12);
    border-color: rgba(160, 255, 79, 0.25);
    transform: translateX(2px);
  }
  .option:active { transform: scale(0.97); }
  .option:hover .option-icon { opacity: 1; }
  .option:hover .option-icon svg { stroke: #a0ff4f; }
  .option:hover .option-label { color: rgba(255, 255, 255, 0.95); }

  @keyframes slideIn { to { opacity: 1; transform: translateX(0); } }

  .option-icon {
    width: 28px; height: 28px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.06);
    opacity: 0.5; flex-shrink: 0;
    transition: all 0.18s ease;
  }
  .option-icon svg {
    width: 14px; height: 14px; stroke: #fff; stroke-width: 2;
    fill: none; stroke-linecap: round; stroke-linejoin: round;
    transition: stroke 0.18s ease;
  }

  .option-label {
    font-size: 12.5px; font-weight: 500;
    color: rgba(255, 255, 255, 0.55);
    white-space: nowrap; letter-spacing: 0.01em;
    transition: color 0.18s ease;
  }
</style>
</head>
<body>

<div id="target-wrapper">
  <div class="eye">
    <div class="eye-pulse"></div>
    <div class="eye-ring"></div>
    <div class="eye-dot"></div>
  </div>
  <div class="options" id="options-container"></div>
</div>

<!-- SVG Icon Library -->
<svg style="display:none" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <symbol id="icon-lock" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></symbol>
    <symbol id="icon-unlock" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></symbol>
    <symbol id="icon-key" viewBox="0 0 24 24"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></symbol>
    <symbol id="icon-warehouse" viewBox="0 0 24 24"><path d="M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z"/><path d="M6 18h12"/><path d="M6 14h12"/><path d="M6 10h12"/></symbol>
    <symbol id="icon-message" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></symbol>
    <symbol id="icon-shop" viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></symbol>
    <symbol id="icon-door" viewBox="0 0 24 24"><path d="M13 4h3a2 2 0 0 1 2 2v14"/><path d="M2 20h3"/><path d="M13 20h9"/><path d="M10 12v.01"/><path d="M13 4.562v16.157a1 1 0 0 1-1.242.97L5 20V5.562a2 2 0 0 1 1.515-1.94l4-1A2 2 0 0 1 13 4.561Z"/></symbol>
    <symbol id="icon-wrench" viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></symbol>
    <symbol id="icon-eye" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></symbol>
    <symbol id="icon-gas" viewBox="0 0 24 24"><path d="M3 22V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v17"/><path d="M15 12h2a2 2 0 0 1 2 2v3a1.5 1.5 0 0 0 3 0V7l-3-3"/><path d="M3 22h12"/><path d="M7 7h4"/></symbol>
    <symbol id="icon-car" viewBox="0 0 24 24"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18 10l-3-5H9L6 10l-2.5 1.1C2.7 11.3 2 12.1 2 13v3c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></symbol>
    <symbol id="icon-user" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></symbol>
    <symbol id="icon-box" viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></symbol>
    <symbol id="icon-credit" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></symbol>
    <symbol id="icon-heart" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></symbol>
    <symbol id="icon-id" viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 15h0M2 9.5h20"/></symbol>
    <symbol id="icon-handshake" viewBox="0 0 24 24"><path d="M11 17a1 1 0 0 1-1 1H5l-3-3 3.5-3.5L9 15"/><path d="M14 7l5 5-3.5 3.5"/><path d="m18 4 1 1"/><path d="m5 21 1-1"/></symbol>
    <symbol id="icon-leaf" viewBox="0 0 24 24"><path d="M11 20A7 7 0 0 1 9.8 6.9C15.5 4.9 17 3.5 19 2c1 2 2 4.5 2 8 0 5.5-4.5 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></symbol>
    <symbol id="icon-cog" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></symbol>
    <symbol id="icon-dollar" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></symbol>
  </defs>
</svg>

<script>
(function() {
  var ICON_MAP = {
    'lock': '#icon-lock', 'unlock': '#icon-unlock', 'key': '#icon-key',
    'warehouse': '#icon-warehouse', 'message': '#icon-message',
    'shop': '#icon-shop', 'door': '#icon-door', 'wrench': '#icon-wrench',
    'eye': '#icon-eye', 'gas': '#icon-gas', 'car': '#icon-car',
    'user': '#icon-user', 'box': '#icon-box', 'credit': '#icon-credit',
    'heart': '#icon-heart', 'id': '#icon-id', 'handshake': '#icon-handshake',
    'leaf': '#icon-leaf', 'cog': '#icon-cog', 'dollar': '#icon-dollar',
    'fas fa-lock': '#icon-lock', 'fas fa-unlock': '#icon-unlock',
    'fas fa-key': '#icon-key', 'fas fa-warehouse': '#icon-warehouse',
    'fas fa-comments': '#icon-message', 'fas fa-comment': '#icon-message',
    'fas fa-shopping-cart': '#icon-shop', 'fas fa-store': '#icon-shop',
    'fas fa-door-open': '#icon-door', 'fas fa-door-closed': '#icon-door',
    'fas fa-wrench': '#icon-wrench', 'fas fa-tools': '#icon-wrench',
    'fas fa-eye': '#icon-eye', 'fas fa-gas-pump': '#icon-gas',
    'fas fa-car': '#icon-car', 'fas fa-user': '#icon-user',
    'fas fa-box-open': '#icon-box', 'fas fa-box': '#icon-box',
    'fas fa-credit-card': '#icon-credit', 'fas fa-heart': '#icon-heart',
    'fas fa-id-card': '#icon-id', 'fas fa-handshake': '#icon-handshake',
    'fas fa-hand-holding-medical': '#icon-heart',
    'fas fa-leaf': '#icon-leaf', 'fas fa-seedling': '#icon-leaf',
    'fas fa-cannabis': '#icon-leaf', 'fas fa-pagelines': '#icon-leaf',
    'fas fa-cog': '#icon-cog', 'fas fa-cogs': '#icon-cog',
    'fas fa-gear': '#icon-cog', 'fas fa-gears': '#icon-cog',
    'fas fa-dollar-sign': '#icon-dollar', 'fas fa-money-bill': '#icon-dollar',
    'fas fa-money-bill-wave': '#icon-dollar',
  };

  var IS_FIVEM = typeof GetParentResourceName === 'function';
  var RESOURCE = IS_FIVEM ? GetParentResourceName() : 'nova_target';
  var wrapper = document.getElementById('target-wrapper');
  var container = document.getElementById('options-container');

  function postNUI(event, data) {
    if (!IS_FIVEM) return;
    fetch('https://' + RESOURCE + '/' + event, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data || {})
    }).catch(function() {});
  }

  function resolveIcon(iconName) {
    if (!iconName) return '#icon-eye';
    if (ICON_MAP[iconName]) return ICON_MAP[iconName];
    if (ICON_MAP[iconName.toLowerCase()]) return ICON_MAP[iconName.toLowerCase()];
    return '#icon-eye';
  }

  function renderOptions(options) {
    container.innerHTML = '';
    if (!options || options.length === 0) return;

    for (var i = 0; i < options.length; i++) {
      var opt = options[i];
      var el = document.createElement('div');
      el.className = 'option';
      el.style.animationDelay = (i * 0.04) + 's';

      var iconDiv = document.createElement('div');
      iconDiv.className = 'option-icon';
      var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('viewBox', '0 0 24 24');
      var use = document.createElementNS('http://www.w3.org/2000/svg', 'use');
      use.setAttributeNS('http://www.w3.org/1999/xlink', 'href', resolveIcon(opt.icon));
      svg.appendChild(use);
      iconDiv.appendChild(svg);

      var label = document.createElement('span');
      label.className = 'option-label';
      label.textContent = opt.label || 'Interact';

      el.appendChild(iconDiv);
      el.appendChild(label);

      (function(index) {
        el.addEventListener('click', function() {
          postNUI('selectOption', { index: index });
        });
      })(opt.index || (i + 1));

      container.appendChild(el);
    }
  }

  window.addEventListener('message', function(event) {
    var d = event.data;
    if (!d || !d.type) return;

    if (d.type === 'setEye') {
      var visible = d.visible === 1 || d.visible === true;
      var targeted = d.hasTarget === 1 || d.hasTarget === true;

      if (visible) {
        wrapper.classList.add('visible');
      } else {
        wrapper.classList.remove('visible');
        wrapper.classList.remove('has-target');
        container.innerHTML = '';
        return;
      }

      if (targeted) {
        wrapper.classList.add('has-target');
      } else {
        wrapper.classList.remove('has-target');
        container.innerHTML = '';
      }
    }

    if (d.type === 'setOptions') {
      var opts = d.options || [];
      if (opts.length > 0) {
        renderOptions(opts);
      } else {
        container.innerHTML = '';
      }
    }

    if (d.type === 'hide') {
      wrapper.classList.remove('visible');
      wrapper.classList.remove('has-target');
      container.innerHTML = '';
    }
  });

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      postNUI('closeTarget', {});
    }
  });
})();
</script>
</body>
</html>
